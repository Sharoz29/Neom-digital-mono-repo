# This file is generated by Nx.
#
# Build the docker image with `npx nx docker-build alfresco-api`.
# Tip: Modify "docker-build" options in project.json to change docker build args.
#
# Run the container with `docker run -p 3001:3001 -t alfresco-api`.
FROM docker.io/node:20.10.0-alpine

ENV HOST=0.0.0.0
ENV PORT=3001

WORKDIR /app

RUN addgroup --system alfresco-api && \
adduser --system -G alfresco-api alfresco-api

COPY package.* alfresco-api/
RUN npm --prefix alfresco-api --omit=dev -f install


COPY dist/apps/alfresco-api alfresco-api/
RUN chown -R alfresco-api:alfresco-api .

RUN npm install pm2 -g
ENV PM2_PUBLIC_KEY ur3z4mifggsqhhm
ENV PM2_SECRET_KEY 1psvz0wwwi6clpr

# You can remove this install step if you build with `--bundle` option.
# The bundled output will include external dependencies.
WORKDIR /app/alfresco-api

CMD [ "pm2-runtime", "main.js" ]
